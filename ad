[1mdiff --git a/industry_alert/account/models.py b/industry_alert/account/models.py[m
[1mindex 71a8362..ec96231 100755[m
[1m--- a/industry_alert/account/models.py[m
[1m+++ b/industry_alert/account/models.py[m
[36m@@ -1,3 +1,65 @@[m
 from django.db import models[m
[32m+[m[32mfrom django.contrib.auth.base_user import BaseUserManager, AbstractBaseUser[m
[32m+[m[32mfrom django.contrib.auth.models import PermissionsMixin[m
 [m
[31m-# Create your models here.[m
[32m+[m
[32m+[m[32m# https://docs.djangoproject.com/en/3.2/ref/contrib/auth/[m
[32m+[m[32mclass AccountManager(BaseUserManager):[m
[32m+[m[32m    def create_user(self, email, password, name):[m
[32m+[m[32m        if not email:[m
[32m+[m[32m            raise ValueError('Users must have an email address')[m
[32m+[m[32m        print('ì–´ì¹´ìš´íŠ¸')[m
[32m+[m[32m        # ì´ê±° ê·¼ë° ê¼­ í•´ì•¼í•˜ëŠ”ê±´ì§€ëŠ” ëª¨ë¥´ê² ìŒ[m
[32m+[m[32m        user = self.model([m
[32m+[m[32m            # normalize_email()ì´ê±°ëŠ” @domainì—ì„œ domainë§Œ ì†Œë¬¸ìë¡œ ë§Œë“¬[m
[32m+[m[32m            email=self.normalize_email(email),[m
[32m+[m[32m            name=name[m
[32m+[m[32m        )[m
[32m+[m
[32m+[m[32m        # Sets the userâ€™s password to the given raw string,[m
[32m+[m[32m        # taking care of the password hashing. Doesnâ€™t save the User object.[m
[32m+[m[32m        user.set_password(password)[m
[32m+[m[32m        user.save()[m
[32m+[m[32m        return user[m
[32m+[m
[32m+[m[32m    def create_superuser(self, email, password, name):[m
[32m+[m[32m        user = self.create_user([m
[32m+[m[32m            email=self.normalize_email(email),[m
[32m+[m[32m            password=password,[m
[32m+[m[32m            name=name[m
[32m+[m[32m        )[m
[32m+[m
[32m+[m[32m        # https://docs.djangoproject.com/en/3.2/ref/contrib/auth/[m
[32m+[m[32m        user.is_admin = True[m
[32m+[m[32m        user.is_active = True[m
[32m+[m[32m        user.is_superuser = True[m
[32m+[m[32m        user.save()[m
[32m+[m
[32m+[m
[32m+[m[32m# drf login[m
[32m+[m[32m# https://medium.com/geekculture/register-login-and-logout-users-in-django-rest-framework-51486390c29[m
[32m+[m[32m# https://github.com/django/django/blob/910ecd1b8df7678f45c3d507dde6bcb1faafa243/django/contrib/auth/base_user.py#L16 ì°¸ì¡°í•˜ê¸°[m
[32m+[m[32m# ì—¬ê¸°ì— ì´ë¦„ ìƒë…„ì›”ì¼ ì „í™”ë²ˆí˜¸ ê°™ì€ ê±° ë” ì¶”ê°€í•˜ê¸°[m
[32m+[m[32mclass User(AbstractBaseUser, PermissionsMixin):[m
[32m+[m[32m    email = models.EmailField(verbose_name="email", max_length=60, unique=True, default=None)[m
[32m+[m[32m    password = models.CharField(verbose_name='password', max_length=255)[m
[32m+[m[32m    # charfieldëŠ” null trueí•˜ëŠ”ê±°ì•„ë‹˜ ê°’ì´ ë¹„ì–´ìˆë‹¤ë¥¼ í‘œì‹œí•˜ëŠ”ê²Œ ë¹ˆìŠ¤íŠ¸ë§ì´ë‘ null ë‘ê°€ì§€ê°€ ë‹¤ë˜ë©´ì„œ ê³±ì°½ë‚¨[m
[32m+[m[32m    name = models.CharField(verbose_name='name', max_length=30, default='', blank=True)[m
[32m+[m[32m    is_admin = models.BooleanField(default=False)[m
[32m+[m[32m    is_superuser = models.BooleanField(default=False)[m
[32m+[m
[32m+[m[32m    # usernameìœ¼ë¡œ 'email' field ì‚¬ìš©í•¨[m
[32m+[m[32m    USERNAME_FIELD = 'email'[m
[32m+[m
[32m+[m[32m    # superuser ìƒì„±ì‹œ ì¶”ê°€ë¡œ ë°›ì„ê±°[m
[32m+[m[32m    # https://docs.djangoproject.com/en/3.2/topics/auth/customizing/[m
[32m+[m[32m    REQUIRED_FIELDS = ['name'][m
[32m+[m
[32m+[m[32m    objects = AccountManager()[m
[32m+[m
[32m+[m[32m    @property[m
[32m+[m[32m    def is_staff(self):[m
[32m+[m[32m        return self.is_admin[m
[32m+[m
[32m+[m[32m    def __str__(self):[m
[32m+[m[32m        return str(self.email)[m
\ No newline at end of file[m
[1mdiff --git a/industry_alert/account/serializers.py b/industry_alert/account/serializers.py[m
[1mindex e69de29..2d98842 100644[m
[1m--- a/industry_alert/account/serializers.py[m
[1m+++ b/industry_alert/account/serializers.py[m
[36m@@ -0,0 +1,105 @@[m
[32m+[m[32mfrom rest_framework import serializers[m
[32m+[m[32mfrom .models import User[m
[32m+[m[32mfrom django.contrib.auth import get_user_model[m
[32m+[m[32mfrom rest_framework.authtoken.models import Token[m
[32m+[m[32m# get_user_model() : í´ë˜ìŠ¤ì´ë‹¤.[m
[32m+[m[32m# >>> get_user_model()[m
[32m+[m[32m# <class 'accounts.models.User'>[m
[32m+[m[32m# settings.AUTH_USER_MODEL : ë¬¸ìì—´ì´ë‹¤.[m
[32m+[m[32m# >>> settings.AUTH_USER_MODEL[m
[32m+[m[32m# >>> settings.AUTH_USER_MODEL[m
[32m+[m[32m# 'accounts.User'[m
[32m+[m
[32m+[m[32m# exceptions[m
[32m+[m[32mclass InvalidPassword(Exception):[m
[32m+[m[32m    pass[m
[32m+[m[32m# drf[m
[32m+[m[32m# 1. Serializerë¥¼ ìƒì†ë°›ì€ LoginSerializer, ê·¸ë¦¬ê³  ModelSerializerë¥¼ ìƒì†ë°›ì€ UserSerializer ë‘ ê°œ ì‘ì„±[m
[32m+[m[32m# 2. ê° serializerëŠ” ì•„ë˜ì™€ ê°™ì€ fieldë¥¼ ê°€ì§€ê³  ì´ë¦„ì— ë§ëŠ” ë™ì‘ì„ í•´ì•¼í•¨[m
[32m+[m[32m# https://eunjin3786.tistory.com/253[m
[32m+[m[32m# LoginSerializer[m
[32m+[m[32m#     ì“°ê¸°ì „ìš© : username, password[m
[32m+[m[32m#     ì½ê¸°ì „ìš© : token[m
[32m+[m[32m#     ë™ì‘ : usernameê³¼ passwordë¡œ userì¸ì¦ì„ í•˜ê³ , userì˜ tokenì´ ìˆìœ¼ë©´ ê·¸ê²ƒì„, ì—†ìœ¼ë©´ ìƒˆë¡œ ë°œí–‰í•´ì„œ ëŒë ¤ì¤Œ[m
[32m+[m[32mclass LoginSerializer(serializers.Serializer):[m
[32m+[m[32m    # write_onlyëŠ” ê°’ì„ ë°›ì•„ì„œ create/updateê°™ì€ê±°ë§Œ í•˜ëŠ”ê±°ì„[m
[32m+[m[32m    email = serializers.CharField(write_only=True)[m
[32m+[m[32m    password = serializers.CharField(write_only=True)[m
[32m+[m[32m    # ì…ë ¥ë°›ëŠ”ê²Œ ì•„ë‹ˆë¼ returnìœ¼ë¡œ ëŒë ¤ì£¼ëŠ” ê°’ì´ë‹ˆê¹Œ read_onlyì„[m
[32m+[m[32m    token = serializers.CharField(read_only=True)[m
[32m+[m
[32m+[m[32m    # ë¡œê·¸ì¸ í™•ì¸[m
[32m+[m[32m    def create(self, validated_data):[m
[32m+[m[32m        email = validated_data['email'][m
[32m+[m[32m        password = validated_data['password'][m
[32m+[m
[32m+[m[32m        user = User.objects.get(email=email)[m
[32m+[m
[32m+[m[32m        # ë¹„ë°€ë²ˆí˜¸ ì¼ì¹˜í•˜ë©´[m
[32m+[m[32m        if user.check_password(password):[m
[32m+[m[32m            token, _ = Token.objects.get_or_create(user=user)[m
[32m+[m[32m            # ì´ê±° ê·¸ëƒ¥ return token í•˜ë©´ ì•ˆë¼ëŠ” ì´ìœ ëŠ”[m
[32m+[m[32m            # ë°‘ì˜ ìœ ì €ì‹œë¦¬ì–¼ë¼ì´ì €ì—ì„œëŠ” user.tokenì— token.keyë¥¼ ë„£ì–´ì¤¬ëŠ”ë°[m
[32m+[m[32m            # ì´ê±° ë¦¬í„´ë˜ëŠ” objectì—ì„œ getattrë¡œ ë¦¬í„´ fieldë“¤ì´ ë‹¤ ìˆìœ¼ë©´ ì•Œì•„ì„œ ë§Œë“¤ì–´ì£¼ëŠ”ê±´ë°[m
[32m+[m[32m            # ë°‘ì—ì„œëŠ” ë¦¬í„´ì´ userê°ì²´ì˜€ê³  ì´ ê°ì²´ì—ëŠ” class Metaì— ìˆëŠ” 3ê°œì˜ fieldê°€ ë‹¤ ìˆì–´ì„œ ë¬¸ì œì—†ì´ ëœê±°ê³ [m
[32m+[m[32m            # ì§€ê¸ˆì€ tokenì„ ë¦¬í„´í•˜ê²Œ ë˜ë©´ token.tokenì€ ì—†ê³  token.keyì— ì›í•˜ëŠ”ê°’ì´ìˆì§€[m
[32m+[m[32m            # ê·¸ë˜ì„œ ì§€ê¸ˆ ì—ëŸ¬ì¸ {}ê°€ ê°€ëŠ”ê±°ì„[m
[32m+[m[32m            # tokenì„ ë¦¬í„´í•˜ë©´ Token objectì¸ë° ë‚´ê°€ serializerì— ë¦¬í„´í•˜ê² ë‹¤ê³  ëª…ì‹œí•œê±´[m
[32m+[m[32m            # tokenì´ë¼ëŠ” í•„ë“œê³  ë¦¬í„´í•œê±¸ serializeí–ˆì„ë•Œ ë¦¬í„´ ê²°ê³¼ë¬¼ì— tokenì´ë¼ëŠ” attributeê°€ ìˆì–´ì•¼í•˜ëŠ”ë°[m
[32m+[m[32m            # token.tokenì´ ì—†ìœ¼ë‹ˆ ì•„ë¬´ëŸ° ê²°ê³¼ë¬¼ì´ ì•ˆë‚˜ì˜¤ëŠ”ê±°ì„[m
[32m+[m[32m            # ì´ì œ {'token': token.key}ë¥¼ ë¦¬í„´í•˜ë©´ getattr(ë¦¬í„´ ê²°ê³¼ë¬¼, 'token')í•˜ë©´[m
[32m+[m[32m            # ê°’ì´ ìˆìœ¼ë‹ˆ ê²°ê³¼ë¬¼ì´ ë‚˜ì˜¤ëŠ”ê±°ì„[m
[32m+[m[32m            # ê°ì²´ serializeí•˜ë©´ __str__()ë¡œ ë‚˜ì˜¤ëŠ” ê²°ê³¼ë¬¼ì´ ë‚˜ì˜´[m
[32m+[m[32m            # print(getattr(token, 'key'))[m
[32m+[m[32m            print(token.key)[m
[32m+[m[32m            return {'token': token.key}[m
[32m+[m[32m        # ì¼ì¹˜í•˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì—†ìœ¼ë©´[m
[32m+[m[32m        raise InvalidPassword[m
[32m+[m
[32m+[m
[32m+[m[32m# UserSerializer[m
[32m+[m[32m#     ë‘˜ ë‹¤ : í•„ìš”í•œ ëª¨ë“  ìœ ì €ì •ë³´ë“¤[m
[32m+[m[32m#     ì“°ê¸°ì „ìš© : password[m
[32m+[m[32m#     ì½ê¸°ì „ìš© : token[m
[32m+[m[32m#     ë™ì‘ : ë°›ì€ userì •ë³´ë¥¼ í†µí•´ Userë¥¼ ìƒì„±í•˜ê³ , ìƒì„±ëœ userì˜ tokenì„ ìƒˆë¡œ ë°œí–‰í•´ì„œ passwordë¥¼ ì œì™¸í•œ ë‚˜ë¨¸ì§€ ì •ë³´ì™€ í•¨ê»˜ ëŒë ¤ì¤Œ[m
[32m+[m[32mclass UserSerializer(serializers.ModelSerializer):[m
[32m+[m[32m    password = serializers.CharField(write_only=True)[m
[32m+[m[32m    token = serializers.CharField(read_only=True)[m
[32m+[m
[32m+[m[32m    class Meta:[m
[32m+[m[32m        model = get_user_model()[m
[32m+[m[32m        fields = ['email', 'password', 'name', 'token'][m
[32m+[m
[32m+[m[32m    # ì´ê±° ê·¼ë° user.mode()ì—ì„œ í•´ì£¼ëŠ”ë° ì—†ì–´ì•¼í•˜ëŠ”ê±° ê°™ìŒ[m
[32m+[m[32m    # overrideí•˜ëŠ”ê±°ë‹ˆê¹Œ ì¸ì ë§ì¶°ì¤˜ì•¼í•¨[m
[32m+[m[32m    def create(self, validated_data):[m
[32m+[m[32m        print("ìœ ì €ì‹œë¦¬ì–¼ë¼ì´ì € - create")[m
[32m+[m[32m        # ì´ì œ ì´ validate_dataëŠ” validationë„ ëë‚¬ìœ¼ë‹ˆ ì •í•©í•œ ë°ì´í„°ë‹ˆ ê·¸ëƒ¥ ë•Œë ¤ë²„ë¦¬ë©´ ë¨[m
[32m+[m[32m        # ì´ê±° **ì€[m
[32m+[m[32m        # **d means "take all additional named arguments to this function[m
[32m+[m[32m        # and insert them into this parameter as dictionary entries."[m
[32m+[m[32m        # ì´ê±° create_userê°€ ì¸ìë¥¼ 2ê°œ ë°›ì•„ì•¼í•˜ë‹ˆ **validated_data[m
[32m+[m[32m        user = User.objects.create_user(**validated_data)[m
[32m+[m[32m        # ê°€ì ¸ì˜¤ê±°ë‚˜ ìƒì„±í•œê°’ì´ë‘[m
[32m+[m[32m        # ìƒì„±ëëŠ”ì§€ ê°€ì ¸ì˜¨ê±´ì§€ ì—¬ë¶€ë¥¼[m
[32m+[m[32m        # íŠœí”Œë¡œì¤Œ[m
[32m+[m[32m        # ì €ê²Œ ìƒì„±ìœ¼ë¡œ ê°€ì ¸ì˜¨ ê²°ê³¼ë¬¼ì´ë©´ True[m
[32m+[m[32m        # ìˆë˜ê±° ê°€ì ¸ì˜¨ê±°ë©´ False[m
[32m+[m[32m        # _ëŠ” ì•ˆì“¸ê°’ì€ _ë¡œ ì €ì¥í•¨[m
[32m+[m[32m        token, _ = Token.objects.get_or_create(user=user)[m
[32m+[m[32m        # ì´ê±° ê°€ëŠ¥í•œ ì´ìœ ëŠ” userëŠ” Userì˜ ì¸ìŠ¤í„´ìŠ¤ê³  íŒŒì´ì¬ í´ë˜ìŠ¤ëŠ” getter setterì—†ì´ ê± ë­ë“  í•  ìˆ˜ ìˆì–´ì„œ[m
[32m+[m[32m        # ì´ë ‡ê²Œ í•˜ë©´ tokenì´ ì¶”ê°€ê°€ ê°€ëŠ¥í•œê±°ì„[m
[32m+[m[32m        # ì¶”ê°€ë¡œ ê± ê°ì²´ë¥¼ serializeì‹œí‚¤ë©´ ì•„ê¹Œë§í•œ __str__()ê°’ì´ ë“¤ì–´ê°[m
[32m+[m[32m        user.token = token[m
[32m+[m[32m        return user[m
[32m+[m
[32m+[m[32m    def update(self, instance, validated_data):[m
[32m+[m[32m        # items()ì€ key, value íŠœí”ŒìŒì„ íŠœí”Œë¡œ ë¦¬í„´í•˜ëŠ” í•¨ìˆ˜ì„[m
[32m+[m[32m        print(instance.password)[m
[32m+[m[32m        for key, value in validated_data.items():[m
[32m+[m[32m            # ì œì¼ ì²«ë²ˆì§¸ ì¸ìì— keyê°€ ìˆìœ¼ë©´ True ì—†ìœ¼ë©´ False ë°˜í™˜í•˜ëŠ”ê²Œ hasattrì´ê³ [m
[32m+[m[32m            if hasattr(instance, key):[m
[32m+[m[32m                # ê°’ ì €ì¥í•˜ëŠ”ê²Œ setattr[m
[32m+[m[32m                setattr(instance, key, value)[m
[32m+[m[32m        instance.save()[m
[32m+[m[32m        return instance[m
[1mdiff --git a/industry_alert/account/views.py b/industry_alert/account/views.py[m
[1mindex 91ea44a..37c670b 100755[m
[1m--- a/industry_alert/account/views.py[m
[1m+++ b/industry_alert/account/views.py[m
[36m@@ -1,3 +1,121 @@[m
[31m-from django.shortcuts import render[m
[32m+[m[32mfrom rest_framework import viewsets, serializers, status[m
[32m+[m[32mfrom rest_framework.decorators import action[m
[32m+[m[32mfrom rest_framework.response import Response[m
[32m+[m[32mfrom rest_framework.permissions import AllowAny, IsAuthenticated[m
[32m+[m[32mfrom rest_framework.authtoken.models import Token[m
[32m+[m[32mfrom .models import User[m
[32m+[m[32mfrom .serializers import LoginSerializer, UserSerializer, InvalidPassword[m
 [m
[31m-# Create your views here.[m
[32m+[m[32m# drf login[m
[32m+[m[32m# https://stackoverflow.com/questions/26906630/django-rest-framework-authentication-credentials-were-not-provided ì´ê±° ì§€ê¸ˆ í•´ê²°ì•ˆë˜ê³ ìˆìŒ[m
[32m+[m[32mclass AccountViewSet(viewsets.GenericViewSet):[m
[32m+[m[32m    # permission_classes = [AllowAny][m
[32m+[m[32m    queryset = User.objects.all()[m
[32m+[m[32m    serializer_class = UserSerializer[m
[32m+[m
[32m+[m[32m    # @actionì€[m
[32m+[m[32m    # This decorator can be used to add any custom endpoints that don't fit into the standard create/update/delete style.[m
[32m+[m[32m    # @action decorator will respond to GET requests by default.[m
[32m+[m[32m    # We can use the methods argument if we wanted an action that responded to POST requests.[m
[32m+[m[32m    # /.../foo/barë‚˜[m
[32m+[m[32m    # /.../foo/{pk}/bar[m
[32m+[m[32m    # ì´ëŸ° apië¥¼ ì¶”ê°€í•˜ê³ ì‹¶ì„ë•Œì“°ëŠ”ê±°ì„[m
[32m+[m[32m    # detail=Falseë©´ ìœ„ detail=Trueë©´ ì•„ë˜[m
[32m+[m
[32m+[m[32m    # @action(detail=True, methods=['get'])[m
[32m+[m[32m    # def asd(self, request, pk):[m
[32m+[m[32m    # ì´ê±°ë©´ http://localhost:8000/test/login/[pk]/asd ì—¬ê¸°ë¡œ ë“±ë¡ë¨[m
[32m+[m[32m    # detail=Falseì—¬ì•¼ì§€ë§Œ http://localhost:8000/test/login/asd/ë¡œ ê°[m
[32m+[m[32m    # http GET http://127.0.0.1:8000/api/v1/user/asd[m
[32m+[m[32m    @action(methods=['get'], detail=False, permission_classes=[AllowAny])[m
[32m+[m[32m    def asd(self, request):[m
[32m+[m[32m        serializer = self.serializer_class(self.queryset, many=True)[m
[32m+[m[32m        return Response(serializer.data)[m
[32m+[m
[32m+[m[32m    # /api/v1/user ë¡œ GETìš”ì²­ ë°›ì„ user list api (UserSerializer ì‚¬ìš©)[m
[32m+[m[32m    # http GET http://127.0.0.1:8000/api/v1/user "Authorization: Token 01ecad58c74bb6a6c52ab3f8cb6946cb7312e0d6"[m
[32m+[m[32m    def list(self, request):[m
[32m+[m[32m        # self.get_queryset() ì´ê±°ë¡œ queryset = User.objects.all() ì´ê±° ê°€ì ¸ì˜¤ëŠ”ê±°ì„[m
[32m+[m[32m        queryset = self.get_queryset()[m
[32m+[m[32m        serializer = self.get_serializer(queryset, many=True)[m
[32m+[m[32m        return Response(serializer.data)[m
[32m+[m
[32m+[m[32m    # /api/v1/user/pk ë¡œ GETìš”ì²­ ë°›ì„ user retrieve api (UserSerializerì‚¬ìš©)[m
[32m+[m[32m    # http GET http://127.0.0.1:8000/api/v1/user/48 "Authorization: Token 01ecad58c74bb6a6c52ab3f8cb6946cb7312e0d6"[m
[32m+[m[32m    def retrieve(self, request, pk):[m
[32m+[m[32m        # querysetê³¼ pkê°’ì„ ì¸ìë¡œ ë°›ì•„ì„œ,[m
[32m+[m[32m        # queryset.filter(pk=pk)ë¡œ querysetì„ ë½‘ê³ ,[m
[32m+[m[32m        # instance = queryset.get()ìœ¼ë¡œ ê°ì²´ë§Œ ë½‘ì•„ì„œ ë¦¬í„´í•´ ì£¼ëŠ” ë©”ì†Œë“œì„[m
[32m+[m[32m        # => ê²°êµ­, ìœ„ ì½”ë“œëŠ” Customer.objects.get(pk=pk) ë¦¬í„´í•¨[m
[32m+[m[32m        # https://velog.io/@jcinsh/RetrieveUpdateDestroyView-%EC%9D%B4%ED%95%B4 ì°¸ì¡°[m
[32m+[m[32m        # queryset = User.objects.all() ì´ê±°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•˜ëŠ”ê±°ì„[m
[32m+[m[32m        instance = self.get_object()[m
[32m+[m[32m        serializer = self.get_serializer(instance)[m
[32m+[m[32m        return Response(serializer.data)[m
[32m+[m
[32m+[m[32m    # /api/v1/user/pk ë¡œ PATCH ìš”ì²­ ë°›ì„ user update ap[m
[32m+[m[32m    # http PUT http://127.0.0.1:8000/api/v1/user/50 "Authorization: Token 01ecad58c74bb6a6c52ab3f8cb6946cb7312e0d6"[m
[32m+[m[32m    # ì´ê±° ë¹„ë°€ë²ˆí˜¸ë¥¼ ë°”ê¾¸ë ¤ë©´ userserilaierì—ì„œ ë¹„ë°€ë²ˆí˜¸ê°€ readonlyì—¬ì„œ ì•ˆë³´ì´ë‹ˆ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë°”ê¾¸ë ¤ë©´ serializerë¥¼ ìƒˆë¡œ ë§Œë“¤ì–´ì•¼í•¨[m
[32m+[m[32m    def update(self, request, pk):[m
[32m+[m[32m        instance = self.get_object()[m
[32m+[m[32m        # dataì•ì— ë­ê°€ ìˆìœ¼ë‹ˆ ì—…ë°ì´íŠ¸í•¨[m
[32m+[m[32m        serializer = self.get_serializer(instance, data=request.data, partial=True)[m
[32m+[m[32m        try:[m
[32m+[m[32m            serializer.is_valid(raise_exception=True)[m
[32m+[m[32m            serializer.save()[m
[32m+[m[32m            return Response(serializer.data)[m
[32m+[m[32m        except serializers.ValidationError:[m
[32m+[m[32m            return Response({"status": "failed", "errors": serializer.errors})[m
[32m+[m
[32m+[m[32m    # /api/v1/user/pk ë¡œ DELETE ìš”ì²­ ë°›ì„ user delete api (Serializer ì‚¬ìš© x)[m
[32m+[m[32m    # http DELETE http://127.0.0.1:8000/api/v1/user/2000 "Authorization: Token 01ecad58c74bb6a6c52ab3f8cb6946cb7312e0d6"[m
[32m+[m[32m    def delete(self, request, pk):[m
[32m+[m[32m        print("in delete")[m
[32m+[m[32m        instance = self.get_object()[m
[32m+[m[32m        instance.delete()[m
[32m+[m[32m        return Response({'success': True}, status=status.HTTP_204_NO_CONTENT)[m
[32m+[m
[32m+[m[32m    # /api/v1/user ë¡œ POSTìš”ì²­ì„ ë°›ì„ registration api (UserSerializer ì‚¬ìš©)[m
[32m+[m[32m    # http POST http://127.0.0.1:8000/api/v1/user/register email="id@gmail.com" password="pw"[m
[32m+[m[32m    @action(detail=False, methods=['post'], permission_classes=[AllowAny])[m
[32m+[m[32m    def register(self, request):[m
[32m+[m[32m        serializer = self.get_serializer(data=request.data)[m
[32m+[m[32m        try:[m
[32m+[m[32m            serializer.is_valid(raise_exception=True)[m
[32m+[m[32m            # ì´ê±° save()í–ˆì„ë•Œ ë¶ˆë ¤ì˜¤ëŠ” methodëŠ”[m
[32m+[m[32m            # serializer = UserSerializer(data=request.data)ì—ì„œ dataì•ì— ë­ê°€ ì—†ìœ¼ë©´[m
[32m+[m[32m            # UserSerializer.create()ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ê±°ì„[m
[32m+[m[32m            serializer.save()[m
[32m+[m[32m            # ì´ê±° pwëŠ” write_onlyë¼ì„œ ì•ˆë³´ì„[m
[32m+[m[32m            print(serializer.data)[m
[32m+[m[32m            return Response(serializer.data)[m
[32m+[m[32m        except serializers.ValidationError:[m
[32m+[m[32m            return Response({"status": "failed", "errors": serializer.errors})[m
[32m+[m
[32m+[m[32m    # /api/v1/user/login ìœ¼ë¡œ POSTìš”ì²­ì„ ë°›ì„ login api (LoginSerializer ì‚¬ìš©)[m
[32m+[m[32m    # http POST http://127.0.0.1:8000/api/v1/user/login email="id@gmail.com" password="pw"[m
[32m+[m[32m    # ë¡œê·¸ì•„ì›ƒ ì•ˆí•˜ê³  ì„œë²„ê°€ ê·¸ëƒ¥ ë‹«ì•„ì§€ë©´ í† í° ê°’ì´ ìœ ì§€ë˜ëŠ”ê±° ê°™ìŒ ì–´ë–»ê²Œ í•´ê²°í•´ì•¼í•¨?[m
[32m+[m[32m    # ì´ê±° get_or_createë¡œ í•˜ê¸°ë•Œë¬¸ì— ê°™ì€ê±°ì„ ì•ˆê·¸ëŸ¬ë©´ ì„œë²„ê»ë‹¤ì¼°ëŠ”ë° ì• ë“¤ë‹¤ í† í° ë‚ ì•„ê°€ì„œ ë‹¤ ì—ëŸ¬ë‚˜ê±°ë‚˜ ë¡œê·¸ì¸í˜ì´ì§€ë¡œ ë‚ ì•„ê°[m
[32m+[m[32m    # í•´ê²°í•˜ê¸° ìœ„í•´ì„œëŠ” í† í°ì— ë§Œë£Œê¸°í•œì„ ë‘ê³  í† í°ìœ ì¶œëŒ€ë„ credentialì´ ì—†ìœ¼ë©´ ë§Œë£Œì‹œì ì´í›„ì—ëŠ” ë¬´íš¨ì²˜ë¦¬ë˜ë„ë¡ ë‹¤ì‹œë¡œê·¸ì¸ì‹œì¼œë³´ëŠ”ê±°ì§€[m
[32m+[m[32m    @action(detail=False, methods=['post'], permission_classes=[AllowAny])[m
[32m+[m[32m    def login(self, request):[m
[32m+[m[32m        serializer = LoginSerializer(data=request.data)[m
[32m+[m[32m        try:[m
[32m+[m[32m            serializer.is_valid(raise_exception=True)[m
[32m+[m[32m            serializer.save()[m
[32m+[m[32m            return Response(serializer.data)[m
[32m+[m[32m        except InvalidPassword:[m
[32m+[m[32m            return Response({'success': False, 'error': 'íŒ¨ìŠ¤ì›Œë“œê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤'}, status=status.HTTP_400_BAD_REQUEST)[m
[32m+[m[32m        # ì´ê±°ëŠ” user = User.objects.get(email=email)ì—ì„œ ì—†ìœ¼ë©´ ìë™ìœ¼ë¡œ raiseë¨[m
[32m+[m[32m        except User.DoesNotExist:[m
[32m+[m[32m            return Response({'success': False, 'error': 'ìœ ì €ê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤'}, status=status.HTTP_400_BAD_REQUEST)[m
[32m+[m
[32m+[m[32m    # /api/v1/user/logout ìœ¼ë¡œ DELETE ìš”ì²­ì„ ë°›ì„ logout api(Serializer ì‚¬ìš© x)[m
[32m+[m[32m    # http POST http://127.0.0.1:8000/api/v1/user/logout "Authorization: Token f44c39fec18227d5aa555dcbd20aa7d56d0f55ef"[m
[32m+[m[32m    @action(detail=False, methods=['post'], permission_classes=[IsAuthenticated])[m
[32m+[m[32m    def logout(self, request):[m
[32m+[m[32m        request.user.auth_token.delete()[m
[32m+[m
[32m+[m[32m        return Response({'success': "ë¡œê·¸ì•„ì›ƒ ì„±ê³µ"}, status=status.HTTP_200_OK)[m
[32m+[m
[32m+[m[32m    # íŠ¹ì • ìœ ì €ê°€ publish í•œ post ë³´ê¸°[m
\ No newline at end of file[m
[1mdiff --git a/industry_alert/blog/models.py b/industry_alert/blog/models.py[m
[1mindex d486f8e..c380231 100644[m
[1m--- a/industry_alert/blog/models.py[m
[1m+++ b/industry_alert/blog/models.py[m
[36m@@ -2,16 +2,10 @@[m [mfrom django.conf import settings[m
 from django.db import models[m
 from django.utils import timezone[m
 [m
[31m-# drf login[m
[31m-from django.contrib.auth.base_user import BaseUserManager, AbstractBaseUser[m
[31m-from django.contrib.auth.models import PermissionsMixin[m
[31m-[m
 # image[m
 from django.contrib.contenttypes.fields import GenericForeignKey[m
 from django.contrib.contenttypes.models import ContentType[m
 from django.contrib.contenttypes.fields import GenericRelation[m
[31m-# uuid[m
[31m-from uuid import uuid4[m
 [m
 class EntryImage(models.Model):[m
     def productFile(instance, filename):[m
[36m@@ -83,66 +77,4 @@[m [mclass Comment(models.Model):[m
         self.save()[m
 [m
     def __str__(self):[m
[31m-        return self.text[m
[31m-[m
[31m-[m
[31m-# https://docs.djangoproject.com/en/3.2/ref/contrib/auth/[m
[31m-class AccountManager(BaseUserManager):[m
[31m-    def create_user(self, email, password, name):[m
[31m-        if not email:[m
[31m-            raise ValueError('Users must have an email address')[m
[31m-        print('ì–´ì¹´ìš´íŠ¸')[m
[31m-        # ì´ê±° ê·¼ë° ê¼­ í•´ì•¼í•˜ëŠ”ê±´ì§€ëŠ” ëª¨ë¥´ê² ìŒ[m
[31m-        user = self.model([m
[31m-            # normalize_email()ì´ê±°ëŠ” @domainì—ì„œ domainë§Œ ì†Œë¬¸ìë¡œ ë§Œë“¬[m
[31m-            email=self.normalize_email(email),[m
[31m-            name=name[m
[31m-        )[m
[31m-[m
[31m-        # Sets the userâ€™s password to the given raw string,[m
[31m-        # taking care of the password hashing. Doesnâ€™t save the User object.[m
[31m-        user.set_password(password)[m
[31m-        user.save()[m
[31m-        return user[m
[31m-[m
[31m-    def create_superuser(self, email, password, name):[m
[31m-        user = self.create_user([m
[31m-            email=self.normalize_email(email),[m
[31m-            password=password,[m
[31m-            name=name[m
[31m-        )[m
[31m-[m
[31m-        # https://docs.djangoproject.com/en/3.2/ref/contrib/auth/[m
[31m-        user.is_admin = True[m
[31m-        user.is_active=True[m
[31m-        user.is_superuser = True[m
[31m-        user.save()[m
[31m-[m
[31m-[m
[31m-# drf login[m
[31m-# https://medium.com/geekculture/register-login-and-logout-users-in-django-rest-framework-51486390c29[m
[31m-# https://github.com/django/django/blob/910ecd1b8df7678f45c3d507dde6bcb1faafa243/django/contrib/auth/base_user.py#L16 ì°¸ì¡°í•˜ê¸°[m
[31m-# ì—¬ê¸°ì— ì´ë¦„ ìƒë…„ì›”ì¼ ì „í™”ë²ˆí˜¸ ê°™ì€ ê±° ë” ì¶”ê°€í•˜ê¸°[m
[31m-class User(AbstractBaseUser, PermissionsMixin):[m
[31m-    email = models.EmailField(verbose_name="email", max_length=60, unique=True, default=None)[m
[31m-    password = models.CharField(verbose_name='password',max_length=255)[m
[31m-    # charfieldëŠ” null trueí•˜ëŠ”ê±°ì•„ë‹˜ ê°’ì´ ë¹„ì–´ìˆë‹¤ë¥¼ í‘œì‹œí•˜ëŠ”ê²Œ ë¹ˆìŠ¤íŠ¸ë§ì´ë‘ null ë‘ê°€ì§€ê°€ ë‹¤ë˜ë©´ì„œ ê³±ì°½ë‚¨[m
[31m-    name = models.CharField(verbose_name='name', max_length=30, default='', blank=True)[m
[31m-    is_admin = models.BooleanField(default=False)[m
[31m-    is_superuser = models.BooleanField(default=False)[m
[31m-[m
[31m-    # usernameìœ¼ë¡œ 'email' field ì‚¬ìš©í•¨[m
[31m-    USERNAME_FIELD = 'email'[m
[31m-[m
[31m-    # superuser ìƒì„±ì‹œ ì¶”ê°€ë¡œ ë°›ì„ê±°[m
[31m-    # https://docs.djangoproject.com/en/3.2/topics/auth/customizing/[m
[31m-    REQUIRED_FIELDS = ['name'][m
[31m-    [m
[31m-    objects = AccountManager()[m
[31m-[m
[31m-    @property[m
[31m-    def is_staff(self):[m
[31m-        return self.is_admin[m
[31m-[m
[31m-    def __str__(self):[m
[31m-        return str(self.email)[m
[32m+[m[32m        return self.text[m
\ No newline at end of file[m
[1mdiff --git a/industry_alert/blog/serializers.py b/industry_alert/blog/serializers.py[m
[1mindex e4fda24..6a54560 100644[m
[1m--- a/industry_alert/blog/serializers.py[m
[1m+++ b/industry_alert/blog/serializers.py[m
[36m@@ -1,9 +1,10 @@[m
[31m-from rest_framework import serializers[m
[31m-from .models import Post, Comment, User, EntryImage[m
[32m+[m[32mfrom django.contrib.auth import get_user_model[m
[32m+[m[32mfrom .models import Post, Comment, EntryImage[m
 [m
 # drf[m
[31m-from django.contrib.auth import get_user_model[m
[32m+[m[32mfrom rest_framework import serializers[m
 from rest_framework.authtoken.models import Token[m
[32m+[m[32mfrom rest_framework.exceptions import ValidationError[m
 # get_user_model() : í´ë˜ìŠ¤ì´ë‹¤.[m
 # >>> get_user_model()[m
 # <class 'accounts.models.User'>[m
[36m@@ -23,11 +24,6 @@[m [mclass ImageSerializer(serializers.ModelSerializer):[m
         # 'content_object' ì´ê±°ëŠ” dbì— ì‹¤ì œë¡œ ì¨ì§€ëŠ”ê²Œ ì•„ë‹ˆë¼ì„œ ì—†ì–´ë„ ë¨[m
         fields = ['id', 'image', 'content_type', 'object_id'][m
 [m
[31m-# ì´ê±° ë”°ë¡œ .pyíŒŒì„œ ì˜®ê¸°ê¸°[m
[31m-class InvalidPassword(Exception):[m
[31m-    pass[m
[31m-[m
[31m-[m
 class PostSerializer(serializers.ModelSerializer):[m
     # https://github.com/encode/django-rest-framework/blob/fdb49314754ff13d91c6eec7ccdb8ece52bea9eb/rest_framework/fields.py#L286[m
     author = serializers.HiddenField(default=serializers.CurrentUserDefault())[m
[36m@@ -101,96 +97,4 @@[m [mclass CommentSerializer(serializers.ModelSerializer):[m
     def validate_text(self, value):[m
         if 'ì‹œë²Œ' in value:[m
             raise ValidationError('ìš•í•˜ì§€ë§ˆë¼')[m
[31m-        return value[m
[31m-[m
[31m-[m
[31m-# drf[m
[31m-# 1. Serializerë¥¼ ìƒì†ë°›ì€ LoginSerializer, ê·¸ë¦¬ê³  ModelSerializerë¥¼ ìƒì†ë°›ì€ UserSerializer ë‘ ê°œ ì‘ì„±[m
[31m-# 2. ê° serializerëŠ” ì•„ë˜ì™€ ê°™ì€ fieldë¥¼ ê°€ì§€ê³  ì´ë¦„ì— ë§ëŠ” ë™ì‘ì„ í•´ì•¼í•¨[m
[31m-# https://eunjin3786.tistory.com/253[m
[31m-# LoginSerializer[m
[31m-#     ì“°ê¸°ì „ìš© : username, password[m
[31m-#     ì½ê¸°ì „ìš© : token[m
[31m-#     ë™ì‘ : usernameê³¼ passwordë¡œ userì¸ì¦ì„ í•˜ê³ , userì˜ tokenì´ ìˆìœ¼ë©´ ê·¸ê²ƒì„, ì—†ìœ¼ë©´ ìƒˆë¡œ ë°œí–‰í•´ì„œ ëŒë ¤ì¤Œ[m
[31m-class LoginSerializer(serializers.Serializer):[m
[31m-    # write_onlyëŠ” ê°’ì„ ë°›ì•„ì„œ create/updateê°™ì€ê±°ë§Œ í•˜ëŠ”ê±°ì„[m
[31m-    email = serializers.CharField(write_only=True)[m
[31m-    password = serializers.CharField(write_only=True)[m
[31m-    # ì…ë ¥ë°›ëŠ”ê²Œ ì•„ë‹ˆë¼ returnìœ¼ë¡œ ëŒë ¤ì£¼ëŠ” ê°’ì´ë‹ˆê¹Œ read_onlyì„[m
[31m-    token = serializers.CharField(read_only=True)[m
[31m-[m
[31m-    # ë¡œê·¸ì¸ í™•ì¸[m
[31m-    def create(self, validated_data):[m
[31m-        email = validated_data['email'][m
[31m-        password = validated_data['password'][m
[31m-[m
[31m-        user = User.objects.get(email=email)[m
[31m-[m
[31m-        # ë¹„ë°€ë²ˆí˜¸ ì¼ì¹˜í•˜ë©´[m
[31m-        if user.check_password(password):[m
[31m-            token, _ = Token.objects.get_or_create(user=user)[m
[31m-            # ì´ê±° ê·¸ëƒ¥ return token í•˜ë©´ ì•ˆë¼ëŠ” ì´ìœ ëŠ”[m
[31m-            # ë°‘ì˜ ìœ ì €ì‹œë¦¬ì–¼ë¼ì´ì €ì—ì„œëŠ” user.tokenì— token.keyë¥¼ ë„£ì–´ì¤¬ëŠ”ë°[m
[31m-            # ì´ê±° ë¦¬í„´ë˜ëŠ” objectì—ì„œ getattrë¡œ ë¦¬í„´ fieldë“¤ì´ ë‹¤ ìˆìœ¼ë©´ ì•Œì•„ì„œ ë§Œë“¤ì–´ì£¼ëŠ”ê±´ë°[m
[31m-            # ë°‘ì—ì„œëŠ” ë¦¬í„´ì´ userê°ì²´ì˜€ê³  ì´ ê°ì²´ì—ëŠ” class Metaì— ìˆëŠ” 3ê°œì˜ fieldê°€ ë‹¤ ìˆì–´ì„œ ë¬¸ì œì—†ì´ ëœê±°ê³ [m
[31m-            # ì§€ê¸ˆì€ tokenì„ ë¦¬í„´í•˜ê²Œ ë˜ë©´ token.tokenì€ ì—†ê³  token.keyì— ì›í•˜ëŠ”ê°’ì´ìˆì§€[m
[31m-            # ê·¸ë˜ì„œ ì§€ê¸ˆ ì—ëŸ¬ì¸ {}ê°€ ê°€ëŠ”ê±°ì„[m
[31m-            # tokenì„ ë¦¬í„´í•˜ë©´ Token objectì¸ë° ë‚´ê°€ serializerì— ë¦¬í„´í•˜ê² ë‹¤ê³  ëª…ì‹œí•œê±´[m
[31m-            # tokenì´ë¼ëŠ” í•„ë“œê³  ë¦¬í„´í•œê±¸ serializeí–ˆì„ë•Œ ë¦¬í„´ ê²°ê³¼ë¬¼ì— tokenì´ë¼ëŠ” attributeê°€ ìˆì–´ì•¼í•˜ëŠ”ë°[m
[31m-            # token.tokenì´ ì—†ìœ¼ë‹ˆ ì•„ë¬´ëŸ° ê²°ê³¼ë¬¼ì´ ì•ˆë‚˜ì˜¤ëŠ”ê±°ì„[m
[31m-            # ì´ì œ {'token': token.key}ë¥¼ ë¦¬í„´í•˜ë©´ getattr(ë¦¬í„´ ê²°ê³¼ë¬¼, 'token')í•˜ë©´[m
[31m-            # ê°’ì´ ìˆìœ¼ë‹ˆ ê²°ê³¼ë¬¼ì´ ë‚˜ì˜¤ëŠ”ê±°ì„[m
[31m-            # ê°ì²´ serializeí•˜ë©´ __str__()ë¡œ ë‚˜ì˜¤ëŠ” ê²°ê³¼ë¬¼ì´ ë‚˜ì˜´[m
[31m-            # print(getattr(token, 'key'))[m
[31m-            print(token.key)[m
[31m-            return {'token': token.key}[m
[31m-        # ì¼ì¹˜í•˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì—†ìœ¼ë©´[m
[31m-        raise InvalidPassword[m
[31m-[m
[31m-[m
[31m-# UserSerializer[m
[31m-#     ë‘˜ ë‹¤ : í•„ìš”í•œ ëª¨ë“  ìœ ì €ì •ë³´ë“¤[m
[31m-#     ì“°ê¸°ì „ìš© : password[m
[31m-#     ì½ê¸°ì „ìš© : token[m
[31m-#     ë™ì‘ : ë°›ì€ userì •ë³´ë¥¼ í†µí•´ Userë¥¼ ìƒì„±í•˜ê³ , ìƒì„±ëœ userì˜ tokenì„ ìƒˆë¡œ ë°œí–‰í•´ì„œ passwordë¥¼ ì œì™¸í•œ ë‚˜ë¨¸ì§€ ì •ë³´ì™€ í•¨ê»˜ ëŒë ¤ì¤Œ[m
[31m-class UserSerializer(serializers.ModelSerializer):[m
[31m-    password = serializers.CharField(write_only=True)[m
[31m-    token = serializers.CharField(read_only=True)[m
[31m-[m
[31m-    class Meta:[m
[31m-        model = get_user_model()[m
[31m-        fields = ['email', 'password', 'name', 'token'][m
[31m-[m
[31m-    # ì´ê±° ê·¼ë° user.mode()ì—ì„œ í•´ì£¼ëŠ”ë° ì—†ì–´ì•¼í•˜ëŠ”ê±° ê°™ìŒ[m
[31m-    # overrideí•˜ëŠ”ê±°ë‹ˆê¹Œ ì¸ì ë§ì¶°ì¤˜ì•¼í•¨[m
[31m-    def create(self, validated_data):[m
[31m-        print("ìœ ì €ì‹œë¦¬ì–¼ë¼ì´ì € - create")[m
[31m-        # ì´ì œ ì´ validate_dataëŠ” validationë„ ëë‚¬ìœ¼ë‹ˆ ì •í•©í•œ ë°ì´í„°ë‹ˆ ê·¸ëƒ¥ ë•Œë ¤ë²„ë¦¬ë©´ ë¨[m
[31m-        # ì´ê±° **ì€[m
[31m-        # **d means "take all additional named arguments to this function[m
[31m-        # and insert them into this parameter as dictionary entries."[m
[31m-        # ì´ê±° create_userê°€ ì¸ìë¥¼ 2ê°œ ë°›ì•„ì•¼í•˜ë‹ˆ **validated_data[m
[31m-        user = User.objects.create_user(**validated_data)[m
[31m-        # ê°€ì ¸ì˜¤ê±°ë‚˜ ìƒì„±í•œê°’ì´ë‘[m
[31m-        # ìƒì„±ëëŠ”ì§€ ê°€ì ¸ì˜¨ê±´ì§€ ì—¬ë¶€ë¥¼[m
[31m-        # íŠœí”Œë¡œì¤Œ[m
[31m-        # ì €ê²Œ ìƒì„±ìœ¼ë¡œ ê°€ì ¸ì˜¨ ê²°ê³¼ë¬¼ì´ë©´ True[m
[31m-        # ìˆë˜ê±° ê°€ì ¸ì˜¨ê±°ë©´ False[m
[31m-        # _ëŠ” ì•ˆì“¸ê°’ì€ _ë¡œ ì €ì¥í•¨[m
[31m-        token, _ = Token.objects.get_or_create(user=user)[m
[31m-        # ì´ê±° ê°€ëŠ¥í•œ ì´ìœ ëŠ” userëŠ” Userì˜ ì¸ìŠ¤í„´ìŠ¤ê³  íŒŒì´ì¬ í´ë˜ìŠ¤ëŠ” getter setterì—†ì´ ê± ë­ë“  í•  ìˆ˜ ìˆì–´ì„œ[m
[31m-        # ì´ë ‡ê²Œ í•˜ë©´ tokenì´ ì¶”ê°€ê°€ ê°€ëŠ¥í•œê±°ì„[m
[31m-        # ì¶”ê°€ë¡œ ê± ê°ì²´ë¥¼ serializeì‹œí‚¤ë©´ ì•„ê¹Œë§í•œ __str__()ê°’ì´ ë“¤ì–´ê°[m
[31m-        user.token = token[m
[31m-        return user[m
[31m-[m
[31m-    def update(self, instance, validated_data):[m
[31m-        # items()ì€ key, value íŠœí”ŒìŒì„ íŠœí”Œë¡œ ë¦¬í„´í•˜ëŠ” í•¨ìˆ˜ì„[m
[31m-        print(instance.password)[m
[31m-        for key, value in validated_data.items():[m
[31m-            # ì œì¼ ì²«ë²ˆì§¸ ì¸ìì— keyê°€ ìˆìœ¼ë©´ True ì—†ìœ¼ë©´ False ë°˜í™˜í•˜ëŠ”ê²Œ hasattrì´ê³ [m
[31m-            if hasattr(instance, key):[m
[31m-                # ê°’ ì €ì¥í•˜ëŠ”ê²Œ setattr[m
[31m-                setattr(instance, key, value)[m
[31m-        instance.save()[m
[31m-        return instance[m
[32m+[m[32m        return value[m
\ No newline at end of file[m
[1mdiff --git a/industry_alert/blog/views.py b/industry_alert/blog/views.py[m
[1mindex f27e65c..5397489 100644[m
[1m--- a/industry_alert/blog/views.py[m
[1m+++ b/industry_alert/blog/views.py[m
[36m@@ -3,6 +3,7 @@[m [mfrom django.utils import timezone # timezone.now() ì‚¬ìš©í•˜ê¸° ìœ„í•¨ì„[m
 from rest_framework.exceptions import ParseError[m
 [m
 from .models import Post, Comment # Postëª¨ë¸, Commentëª¨ë¸ì„ ë¶ˆëŸ¬ì˜¤ê¸° ìœ„í•¨ì„[m
[32m+[m[32mfrom .serializers import PostSerializer, CommentSerializer[m
 from .forms import PostForm, CommentForm[m
 from django.shortcuts import redirect[m
 from django.contrib.auth.decorators import login_required[m
[36m@@ -11,8 +12,6 @@[m [mfrom django.contrib.auth.decorators import login_required[m
 from rest_framework import viewsets[m
 from rest_framework.decorators import action[m
 from rest_framework.response import Response[m
[31m-from blog.models import Post, Comment, User[m
[31m-from blog.serializers import PostSerializer, CommentSerializer, LoginSerializer, UserSerializer, InvalidPassword[m
 from rest_framework.permissions import AllowAny, IsAuthenticated[m
 from rest_framework import serializers[m
 from rest_framework import status[m
[36m@@ -112,55 +111,31 @@[m [mclass EveLoginViewSet(viewsets.GenericViewSet):[m
                 headers=headers,[m
                 data=body[m
             )[m
[31m-            res.raise_for_status()[m
             res_dict = res.json()[m
[31m-        except requests.exceptions.ConnectionError as e:[m
[31m-            return Response({"status": "failed", "errors": str(e)})[m
[31m-        except requests.exceptions.Timeout as e:[m
[31m-            return Response({"status": "failed", "errors": str(e)})[m
[31m-        except requests.exceptions.TooManyRedirects as e:[m
[31m-            return Response({"status": "failed", "errors": str(e)})[m
[31m-        # raise_for_status()[m
[31m-        except requests.exceptions.HTTPError as e:[m
[31m-            return Response({"status": "failed", "errors": str(e)})[m
[31m-        # res.json()[m
[31m-        except requests.exceptions.JSONDecodeError as e:[m
[31m-            return Response({"status": "failed", "errors": str(e)})[m
[31m-        # ìœ„ì—ì„œ ê±¸ë¦¬ì§€ ì•Šì€ ë‹¤ë¥¸ ëª¨ë“  exceptions[m
[31m-        except requests.exceptions.RequestException as e:[m
[31m-            return Response({"status": "failed", "errors": str(e)})[m
[31m-        [m
[31m-        if 'error' in res_dict:[m
[31m-            return Response({"status": "failed", "errors": "something went wrong"})[m
[32m+[m[32m            access_token = res_dict.get('access_token')[m
[32m+[m[32m            # ì´ê±° ì–´ì°¨í”¼ ì—¬ê¸°ì„œ access_tokenì´ ì•ˆì˜¨ê±°ë©´ ì—°ê²°ì´  ì‹¤íŒ¨í•œê±°ì„[m
[32m+[m[32m            # ê·¸ëŸ¬ë‹ˆê¹Œ ì˜ˆì™¸ëŠ” ì—¬ê¸°ì„œ keyErrorí•˜ë‚˜ë§Œ ì¡ê³  ë‚˜ë¨¸ì§€ ë‹¤ë¥¸ ì—ëŸ¬ëŠ”[m
[32m+[m[32m            # djangoì—ì„œ 500ì—ëŸ¬ ì£¼ë‹ˆ ì´ê±° logging í•´ì„œ ì¡ì•„ë‚´ë©´ë¨[m
[32m+[m[32m            # í´ë¼ì´ì–¸íŠ¸ëŠ” ì¡ë‹¤í•œ ì˜ˆì™¸ ìƒí™© ì•Œ í•„ìš”ì—†ê³  ì—¬ê¸° ê¸°ì¤€ìœ¼ë¡œëŠ” ì´ë¸Œì™€ì˜ ì„œë²„ í†µì‹ ì„ ì‹¤íŒ¨í•œê±°ë§Œ ì•Œë©´ ë˜ê¸° ë–„ë¬¸ì—[m
[32m+[m[32m            # ê·¸ëƒ¥ access_token ì—†ìœ¼ë©´ ì´ë¸Œ ì„œë²„ì™€ì˜ í†µì‹ ì´ ì‹¤íŒ¨í•œê±°ë‹ˆ ì‹¤íŒ¨í–ˆë‹¤ê³  ì•Œë ¤ì£¼ë©´ë¨.[m
[32m+[m[32m        except KeyError:[m
[32m+[m[32m            return Response({"status": "failed", "errors": "ì´ë¸Œì„œë²„ì™€ í†µì‹ ì„ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."})[m
[32m+[m
         # If the previous step was done correctly, the EVE SSO will respond with a JSON payload containing an access token (which is a Json Web Token) [m
         # and a refresh token that looks like this (Anything wrapped by <> will look different for you):[m
[31m-        # ì´ê²Œ resì— ì €ì¥ë¨[m
[31m-        acc = 'Bearer ' + res_dict['access_token'][m
[32m+[m[32m        # ì—¬ê¸°ì„œ ë§í•˜ëŠ” JSON payloadê°€ ìœ„ì˜ resì— ì €ì¥ë¨[m
[32m+[m[32m        acc = 'Bearer ' + access_token[m
         try:[m
             character_res = requests.get([m
                 "https://login.eveonline.com/oauth/verify",[m
[31m-                headers= {'Authorization': acc}[m
[32m+[m[32m                headers={"Authorization": acc}[m
             )[m
[31m-            character_res.raise_for_status()[m
             character_dict = character_res.json()[m
[31m-        except requests.exceptions.ConnectionError as e:[m
[31m-            return Response({"status": "failed", "errors": str(e)})[m
[31m-        except requests.exceptions.Timeout as e:[m
[31m-            return Response({"status": "failed", "errors": str(e)})[m
[31m-        except requests.exceptions.TooManyRedirects as e:[m
[31m-            return Response({"status": "failed", "errors": str(e)})[m
[31m-        # raise_for_status()[m
[31m-        except requests.exceptions.HTTPError as e:[m
[31m-            return Response({"status": "failed", "errors": str(e)})[m
[31m-        # res.json()[m
[31m-        except requests.exceptions.JSONDecodeError as e:[m
[31m-            return Response({"status": "failed", "errors": str(e)})[m
[31m-        # ìœ„ì—ì„œ ê±¸ë¦¬ì§€ ì•Šì€ ë‹¤ë¥¸ ëª¨ë“  exceptions[m
[31m-        except requests.exceptions.RequestException as e:[m
[31m-            return Response({"status": "failed", "errors": str(e)})[m
[31m-[m
[31m-        # urll = 'https://esi.evetech.net/latest/characters/' + str(character_id)+ '/industry/jobs/?datasource=tranquility'[m
[31m-        esi_request_url = self.url_creater(character_dict['CharacterID'], 'industry_jobs')[m
[32m+[m[32m            character_id = character_dict['CharacterID'][m
[32m+[m[32m        except KeyError:[m
[32m+[m[32m            return Response({"status": "failed", "errors": "ì´ë¸Œì„œë²„ì™€ í†µì‹ ì„ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."})[m
[32m+[m
[32m+[m[32m        esi_request_url = self.url_creater(character_id, 'industry_jobs')[m
         [m
         res4 = requests.get([m
              esi_request_url,[m
[36m@@ -404,120 +379,6 @@[m [mclass CommentViewSet(viewsets.GenericViewSet):[m
         except serializers.ValidationError:[m
             return Response({"status": "failed", "errors": serializer.errors})[m
 [m
[31m-# drf login[m
[31m-# https://stackoverflow.com/questions/26906630/django-rest-framework-authentication-credentials-were-not-provided ì´ê±° ì§€ê¸ˆ í•´ê²°ì•ˆë˜ê³ ìˆìŒ[m
[31m-class AccountViewSet(viewsets.GenericViewSet):[m
[31m-    # permission_classes = [AllowAny][m
[31m-    queryset = User.objects.all()[m
[31m-    serializer_class = UserSerializer[m
[31m-[m
[31m-    # @actionì€ [m
[31m-    # This decorator can be used to add any custom endpoints that don't fit into the standard create/update/delete style.[m
[31m-    # @action decorator will respond to GET requests by default. [m
[31m-    # We can use the methods argument if we wanted an action that responded to POST requests.[m
[31m-    # /.../foo/barë‚˜[m
[31m-    # /.../foo/{pk}/bar[m
[31m-    # ì´ëŸ° apië¥¼ ì¶”ê°€í•˜ê³ ì‹¶ì„ë•Œì“°ëŠ”ê±°ì„[m
[31m-    # detail=Falseë©´ ìœ„ detail=Trueë©´ ì•„ë˜[m
[31m-[m
[31m-    # @action(detail=True, methods=['get'])[m
[31m-    # def asd(self, request, pk):[m
[31m-    # ì´ê±°ë©´ http://localhost:8000/test/login/[pk]/asd ì—¬ê¸°ë¡œ ë“±ë¡ë¨[m
[31m-    # detail=Falseì—¬ì•¼ì§€ë§Œ http://localhost:8000/test/login/asd/ë¡œ ê°[m
[31m-    # http GET http://127.0.0.1:8000/api/v1/user/asd[m
[31m-    @action(methods=['get'], detail=False, permission_classes=[AllowAny])[m
[31m-    def asd(self, request):[m
[31m-        serializer = self.serializer_class(self.queryset, many=True)[m
[31m-        return Response(serializer.data)[m
[31m-[m
[31m-    # /api/v1/user ë¡œ GETìš”ì²­ ë°›ì„ user list api (UserSerializer ì‚¬ìš©)[m
[31m-    # http GET http://127.0.0.1:8000/api/v1/user "Authorization: Token 01ecad58c74bb6a6c52ab3f8cb6946cb7312e0d6"[m
[31m-    def list(self, request):[m
[31m-        # self.get_queryset() ì´ê±°ë¡œ queryset = User.objects.all() ì´ê±° ê°€ì ¸ì˜¤ëŠ”ê±°ì„[m
[31m-        queryset = self.get_queryset()[m
[31m-        serializer = self.get_serializer(queryset, many=True)[m
[31m-        return Response(serializer.data)[m
[31m-[m
[31m-    # /api/v1/user/pk ë¡œ GETìš”ì²­ ë°›ì„ user retrieve api (UserSerializerì‚¬ìš©)[m
[31m-    # http GET http://127.0.0.1:8000/api/v1/user/48 "Authorization: Token 01ecad58c74bb6a6c52ab3f8cb6946cb7312e0d6"[m
[31m-    def retrieve(self, request, pk):[m
[31m-        # querysetê³¼ pkê°’ì„ ì¸ìë¡œ ë°›ì•„ì„œ,[m
[31m-        # queryset.filter(pk=pk)ë¡œ querysetì„ ë½‘ê³ ,[m
[31m-        # instance = queryset.get()ìœ¼ë¡œ ê°ì²´ë§Œ ë½‘ì•„ì„œ ë¦¬í„´í•´ ì£¼ëŠ” ë©”ì†Œë“œì„[m
[31m-        # => ê²°êµ­, ìœ„ ì½”ë“œëŠ” Customer.objects.get(pk=pk) ë¦¬í„´í•¨[m
[31m-        # https://velog.io/@jcinsh/RetrieveUpdateDestroyView-%EC%9D%B4%ED%95%B4 ì°¸ì¡°[m
[31m-        # queryset = User.objects.all() ì´ê±°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•˜ëŠ”ê±°ì„[m
[31m-        instance = self.get_object()[m
[31m-        serializer = self.get_serializer(instance)[m
[31m-        return Response(serializer.data)[m
[31m-[m
[31m-    # /api/v1/user/pk ë¡œ PATCH ìš”ì²­ ë°›ì„ user update ap[m
[31m-    # http PUT http://127.0.0.1:8000/api/v1/user/50 "Authorization: Token 01ecad58c74bb6a6c52ab3f8cb6946cb7312e0d6"[m
[31m-    # ì´ê±° ë¹„ë°€ë²ˆí˜¸ë¥¼ ë°”ê¾¸ë ¤ë©´ userserilaierì—ì„œ ë¹„ë°€ë²ˆí˜¸ê°€ readonlyì—¬ì„œ ì•ˆë³´ì´ë‹ˆ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë°”ê¾¸ë ¤ë©´ serializerë¥¼ ìƒˆë¡œ ë§Œë“¤ì–´ì•¼í•¨[m
[31m-    def update(self, request, pk):[m
[31m-        instance = self.get_object()[m
[31m-        # dataì•ì— ë­ê°€ ìˆìœ¼ë‹ˆ ì—…ë°ì´íŠ¸í•¨[m
[31m-        serializer = self.get_serializer(instance, data=request.data, partial=True)[m
[31m-        try:[m
[31m-            serializer.is_valid(raise_exception=True)[m
[31m-            serializer.save()[m
[31m-            return Response(serializer.data)[m
[31m-        except serializers.ValidationError:[m
[31m-            return Response({"status": "failed", "errors": serializer.errors})[m
[31m-[m
[31m-    # /api/v1/user/pk ë¡œ DELETE ìš”ì²­ ë°›ì„ user delete api (Serializer ì‚¬ìš© x)[m
[31m-    # http DELETE http://127.0.0.1:8000/api/v1/user/2000 "Authorization: Token 01ecad58c74bb6a6c52ab3f8cb6946cb7312e0d6"[m
[31m-    def delete(self, request, pk):[m
[31m-        print("in delete")[m
[31m-        instance = self.get_object()[m
[31m-        instance.delete()[m
[31m-        return Response({'success': True}, status=status.HTTP_204_NO_CONTENT)[m
[31m-[m
[31m-    # /api/v1/user ë¡œ POSTìš”ì²­ì„ ë°›ì„ registration api (UserSerializer ì‚¬ìš©)[m
[31m-    # http POST http://127.0.0.1:8000/api/v1/user/register email="id@gmail.com" password="pw"[m
[31m-    @action(detail=False, methods=['post'], permission_classes=[AllowAny])[m
[31m-    def register(self, request):[m
[31m-        serializer = self.get_serializer(data=request.data)[m
[31m-        try:[m
[31m-            serializer.is_valid(raise_exception=True)[m
[31m-            # ì´ê±° save()í–ˆì„ë•Œ ë¶ˆë ¤ì˜¤ëŠ” methodëŠ”[m
[31m-            # serializer = UserSerializer(data=request.data)ì—ì„œ dataì•ì— ë­ê°€ ì—†ìœ¼ë©´[m
[31m-            # UserSerializer.create()ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ê±°ì„[m
[31m-            serializer.save()[m
[31m-            # ì´ê±° pwëŠ” write_onlyë¼ì„œ ì•ˆë³´ì„[m
[31m-            print(serializer.data)[m
[31m-            return Response(serializer.data)[m
[31m-        except serializers.ValidationError:[m
[31m-            return Response({"status": "failed", "errors": serializer.errors})[m
[31m-[m
[31m-    # /api/v1/user/login ìœ¼ë¡œ POSTìš”ì²­ì„ ë°›ì„ login api (LoginSerializer ì‚¬ìš©)[m
[31m-    # http POST http://127.0.0.1:8000/api/v1/user/login email="id@gmail.com" password="pw"[m
[31m-    # ë¡œê·¸ì•„ì›ƒ ì•ˆí•˜ê³  ì„œë²„ê°€ ê·¸ëƒ¥ ë‹«ì•„ì§€ë©´ í† í° ê°’ì´ ìœ ì§€ë˜ëŠ”ê±° ê°™ìŒ ì–´ë–»ê²Œ í•´ê²°í•´ì•¼í•¨?[m
[31m-    # ì´ê±° get_or_createë¡œ í•˜ê¸°ë•Œë¬¸ì— ê°™ì€ê±°ì„ ì•ˆê·¸ëŸ¬ë©´ ì„œë²„ê»ë‹¤ì¼°ëŠ”ë° ì• ë“¤ë‹¤ í† í° ë‚ ì•„ê°€ì„œ ë‹¤ ì—ëŸ¬ë‚˜ê±°ë‚˜ ë¡œê·¸ì¸í˜ì´ì§€ë¡œ ë‚ ì•„ê°[m
[31m-    # í•´ê²°í•˜ê¸° ìœ„í•´ì„œëŠ” í† í°ì— ë§Œë£Œê¸°í•œì„ ë‘ê³  í† í°ìœ ì¶œëŒ€ë„ credentialì´ ì—†ìœ¼ë©´ ë§Œë£Œì‹œì ì´í›„ì—ëŠ” ë¬´íš¨ì²˜ë¦¬ë˜ë„ë¡ ë‹¤ì‹œë¡œê·¸ì¸ì‹œì¼œë³´ëŠ”ê±°ì§€[m
[31m-    @action(detail=False, methods=['post'], permission_classes=[AllowAny])[m
[31m-    def login(self, request):[m
[31m-        serializer = LoginSerializer(data=request.data)[m
[31m-        try:[m
[31m-            serializer.is_valid(raise_exception=True)[m
[31m-            serializer.save()[m
[31m-            return Response(serializer.data)[m
[31m-        except InvalidPassword:[m
[31m-            return Response({'success': False, 'error': 'íŒ¨ìŠ¤ì›Œë“œê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤'}, status=status.HTTP_400_BAD_REQUEST)[m
[31m-        # ì´ê±°ëŠ” user = User.objects.get(email=email)ì—ì„œ ì—†ìœ¼ë©´ ìë™ìœ¼ë¡œ raiseë¨[m
[31m-        except User.DoesNotExist:[m
[31m-            return Response({'success': False, 'error': 'ìœ ì €ê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤'}, status=status.HTTP_400_BAD_REQUEST)[m
[31m-[m
[31m-    # /api/v1/user/logout ìœ¼ë¡œ DELETE ìš”ì²­ì„ ë°›ì„ logout api(Serializer ì‚¬ìš© x)[m
[31m-    # http POST http://127.0.0.1:8000/api/v1/user/logout "Authorization: Token f44c39fec18227d5aa555dcbd20aa7d56d0f55ef"[m
[31m-    @action(detail=False, methods=['post'], permission_classes=[IsAuthenticated])[m
[31m-    def logout(self, request):[m
[31m-        request.user.auth_token.delete()[m
[31m-[m
[31m-        return Response({'success': "ë¡œê·¸ì•„ì›ƒ ì„±ê³µ"}, status=status.HTTP_200_OK)[m
[31m-    [m
[31m-    # íŠ¹ì • ìœ ì €ê°€ publish í•œ post ë³´ê¸°[m
[31m-[m
 def post_list(request):[m
     # ì¿¼ë¦¬ë¥¼ ë§Œë“¤ì–´ì„œ htmlë¡œ ë³´ëƒ„[m
     posts = Post.objects.filter(published_date__lte=timezone.now()).order_by('published_date')[m
[1mdiff --git a/industry_alert/db.sqlite3 b/industry_alert/db.sqlite3[m
[1mdeleted file mode 100644[m
[1mindex 501f3c2..0000000[m
Binary files a/industry_alert/db.sqlite3 and /dev/null differ
[1mdiff --git a/industry_alert/mysite/settings.py b/industry_alert/mysite/settings.py[m
[1mindex ff4f7da..b40da6c 100644[m
[1m--- a/industry_alert/mysite/settings.py[m
[1m+++ b/industry_alert/mysite/settings.py[m
[36m@@ -55,6 +55,7 @@[m [mINSTALLED_APPS = [[m
     'django.contrib.messages',[m
     'django.contrib.staticfiles',[m
     'blog', # blog ì‚¬ìš©í•œë‹¤ê³  ì•Œë ¤ì¤˜ì•¼í•¨[m
[32m+[m[32m    'account',[m
     # drf login[m
     "rest_framework",[m
     "rest_framework.authtoken",[m
[1mdiff --git a/industry_alert/sqlite3.exe b/industry_alert/sqlite3.exe[m
[1mdeleted file mode 100644[m
[1mindex 4ad1ad4..0000000[m
Binary files a/industry_alert/sqlite3.exe and /dev/null differ
